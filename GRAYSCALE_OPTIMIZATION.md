# Оптимизация размера файла через монохромный режим (Grayscale)

## Описание

Добавлена опция конвертации изображений в оттенки серого (grayscale/монохром) для уменьшения размера итогового файла.

## Как это работает

При включении опции `grayscale: true`, все кадры конвертируются в оттенки серого перед JPEG сжатием. Это уменьшает размер файла, потому что:

1. **JPEG лучше сжимает grayscale изображения** - алгоритм JPEG оптимизирован для работы с монохромными изображениями
2. **Меньше цветовой информации** - вместо RGB (3 канала) используется только один канал яркости
3. **Более эффективная квантовка** - при создании GIF палитра содержит только оттенки серого

## Ожидаемое уменьшение размера

- **20-40%** уменьшение размера файла при включении grayscale
- Зависит от типа контента:
  - Текст и UI элементы: ~30-40% уменьшение
  - Фото/изображения: ~20-30% уменьшение
  - Простые формы: ~35-45% уменьшение

## Использование

### Базовое использование

```dart
ScreenRecorderController(
  pixelRatio: 0.25,
  resizeRatio: 0.35,
  jpegQuality: 60,
  grayscale: true,  // Включить монохромный режим
  skipFramesBetweenCaptures: 2,
)
```

### Через ScreenRecorderWrapper

```dart
ScreenRecorderWrapper(
  pixelRatio: 0.25,
  skipFramesBetweenCaptures: 2,
  child: YourApp(),
)
```

И затем в коде создать контроллер с grayscale:

```dart
final controller = ScreenRecorderController(
  grayscale: true,
);
```

## Комбинирование с другими оптимизациями

### Максимальное сжатие (grayscale + агрессивные параметры)

```dart
ScreenRecorderController(
  pixelRatio: 0.2,
  resizeRatio: 0.3,
  jpegQuality: 55,
  grayscale: true,  // Монохром
  maxGifWidth: 300,
  maxGifHeight: 500,
  skipFramesBetweenCaptures: 3,
)
```

**Ожидаемое уменьшение**: ~85-95% от исходного размера

### Сбалансированный режим (grayscale + умеренные параметры)

```dart
ScreenRecorderController(
  pixelRatio: 0.25,
  resizeRatio: 0.35,
  jpegQuality: 60,
  grayscale: true,  // Монохром
  skipFramesBetweenCaptures: 2,
)
```

**Ожидаемое уменьшение**: ~75-85% от исходного размера

## Технические детали

### Процесс обработки кадра с grayscale:

```
1. Захват: toImageSync(pixelRatio: 0.25)
   ↓
2. PNG декодирование
   ↓
3. Ресайз до целевого размера
   ↓
4. Конвертация в grayscale (если включено) ← НОВЫЙ ШАГ
   ↓
5. JPEG сжатие
   ↓
6. Хранение
```

### Реализация

Конвертация выполняется с помощью функции `image.grayscale()` из библиотеки `image`:

```dart
if (grayscale) {
  processedImage = image.grayscale(processedImage);
}
```

Эта функция:
- Конвертирует каждый пиксель в оттенок серого по формуле: `0.299*R + 0.587*G + 0.114*B`
- Сохраняет альфа-канал (прозрачность)
- Оптимизирована для производительности

## Когда использовать

### ✅ Рекомендуется использовать когда:

- Нужен минимальный размер файла
- Цветовая информация не критична
- Записывается текст, UI элементы, схемы
- Нужна максимальная оптимизация

### ❌ Не рекомендуется когда:

- Важна цветовая информация
- Записываются фото, градиенты, цветные диаграммы
- Нужно сохранить визуальную привлекательность

## Сравнение размеров

### Пример для записи 10 секунд (~5 кадров):

| Режим | Размер файла | Качество |
|-------|--------------|----------|
| Цветной (базовый) | ~2-4 МБ | Хорошее |
| **Grayscale** | **~1.2-2.5 МБ** | **Приемлемое** |
| Grayscale + агрессивные параметры | ~0.3-0.8 МБ | Низкое |

### Пример для записи 1 минуты (~30 кадров):

| Режим | Размер файла | Качество |
|-------|--------------|----------|
| Цветной (базовый) | ~10-20 МБ | Хорошее |
| **Grayscale** | **~6-12 МБ** | **Приемлемое** |
| Grayscale + агрессивные параметры | ~1.5-4 МБ | Низкое |

## Отладка

При включенном grayscale в логах будет отображаться пометка:

```
[Exporter] Frame: 1080x1920 -> 378x672 (grayscale), Size: 45.2 KB
```

Без grayscale:

```
[Exporter] Frame: 1080x1920 -> 378x672, Size: 62.8 KB
```

## Параметры по умолчанию

По умолчанию `grayscale: false` - цветной режим включен.

Чтобы включить монохромный режим, нужно явно указать `grayscale: true`.
