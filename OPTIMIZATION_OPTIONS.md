# –í–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤

## üìä –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞—Ö–≤–∞—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

```
1. capture() ‚Üí toImageSync(pixelRatio) ‚Üí ui.Image (–≤ –ø–∞–º—è—Ç–∏, –Ω–µ—Å–∂–∞—Ç–æ–µ)
2. onNewFrame() ‚Üí Frame —Ö—Ä–∞–Ω–∏—Ç ui.Image –≤ –ø–∞–º—è—Ç–∏
3. exportFrames() ‚Üí toByteData(ImageByteFormat.png) ‚Üí PNG –±–∞–π—Ç—ã
4. exportGif() ‚Üí decodePng() ‚Üí encodeGif() ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π GIF
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π `ui.Image` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –≤ –Ω–µ—Å–∂–∞—Ç–æ–º –≤–∏–¥–µ (RGBA, ~8 –ú–ë –Ω–∞ –∫–∞–¥—Ä 1080√ó1920).

---

## üéØ –í–∞—Ä–∏–∞–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–∂–∞—Ç–∏–µ PNG —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞ ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–ò–¥–µ—è:** –í–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è `ui.Image` –≤ –ø–∞–º—è—Ç–∏, —Å—Ä–∞–∑—É –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–∂–∞—Ç—ã–π PNG/JPEG.

**–ì–¥–µ –∏–∑–º–µ–Ω–∏—Ç—å:** `screen_recorder.dart`, –º–µ—Ç–æ–¥ `postFrameCallback` –∏–ª–∏ `exporter.dart`, –º–µ—Ç–æ–¥ `onNewFrame`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```dart
// –í exporter.dart, –∏–∑–º–µ–Ω–∏—Ç—å onNewFrame:
void onNewFrame(Frame frame) async {
  // –°—Ä–∞–∑—É –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –±–∞–π—Ç—ã –∏ —Å–∂–∏–º–∞–µ–º
  final pngBytes = await frame.image.toByteData(format: ui.ImageByteFormat.png);
  if (pngBytes != null) {
    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º PNG
    final decoded = image.decodePng(pngBytes.buffer.asUint8List());
    if (decoded != null) {
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∂–∞—Ç–∏–µ/–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
      final compressed = _compressImage(decoded);
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∂–∞—Ç—ã–µ –±–∞–π—Ç—ã –≤–º–µ—Å—Ç–æ ui.Image
      _compressedFrames.add(CompressedFrame(frame.timeStamp, compressed));
    }
  }
  frame.image.dispose(); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –°—Ä–∞–∑—É –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å –æ—Ç `ui.Image`
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –≤ –ø–∞–º—è—Ç–∏ –≤ 5-10 —Ä–∞–∑
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å JPEG —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85-90% (–µ—â–µ –º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –∑–∞—Ö–≤–∞—Ç–µ (–Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Frame` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
- PNG —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π: **50-70%** –º–µ–Ω—å—à–µ
- JPEG –∫–∞—á–µ—Å—Ç–≤–æ 85%: **80-90%** –º–µ–Ω—å—à–µ (–Ω–æ –ø–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†–µ—Å–∞–π–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞

**–ò–¥–µ—è:** –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–¥—Ä–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞, –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

**–ì–¥–µ –∏–∑–º–µ–Ω–∏—Ç—å:** `exporter.dart`, –º–µ—Ç–æ–¥ `onNewFrame` –∏–ª–∏ `exportFrames`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```dart
void onNewFrame(Frame frame) async {
  // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –±–∞–π—Ç—ã
  final pngBytes = await frame.image.toByteData(format: ui.ImageByteFormat.png);
  if (pngBytes != null) {
    final decoded = image.decodePng(pngBytes.buffer.asUint8List());
    if (decoded != null) {
      // –†–µ—Å–∞–π–∑ –¥–æ 50-70% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞
      final resized = image.copyResize(
        decoded,
        width: (decoded.width * 0.7).round(),
        height: (decoded.height * 0.7).round(),
        interpolation: image.Interpolation.linear, // –∏–ª–∏ cubic –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
      );
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ—Å–∞–π–∑–Ω—É—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      _compressedFrames.add(CompressedFrame(frame.timeStamp, resized));
    }
  }
  frame.image.dispose();
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ (–≤ 2-4 —Ä–∞–∑–∞)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- ‚úÖ –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å —Å–∂–∞—Ç–∏–µ–º

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è –¥–µ—Ç–∞–ª–µ–π (–Ω–æ –¥–ª—è UI –æ–±—ã—á–Ω–æ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ)
- ‚ö†Ô∏è –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å, –∫–∞–∫–æ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
- –†–µ—Å–∞–π–∑ 70%: **~50%** –º–µ–Ω—å—à–µ (0.7¬≤ = 0.49)
- –†–µ—Å–∞–π–∑ 50%: **~75%** –º–µ–Ω—å—à–µ (0.5¬≤ = 0.25)

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JPEG –≤–º–µ—Å—Ç–æ PNG –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ò–¥–µ—è:** –•—Ä–∞–Ω–∏—Ç—å –∫–∞–¥—Ä—ã –∫–∞–∫ JPEG (—Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85-90%) –≤–º–µ—Å—Ç–æ PNG.

**–ì–¥–µ –∏–∑–º–µ–Ω–∏—Ç—å:** `exporter.dart`, –º–µ—Ç–æ–¥ `exportFrames`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```dart
Future<List<RawFrame>?> exportFrames() async {
  final bytesImages = <RawFrame>[];
  for (final frame in _frames) {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ PNG
    final pngBytes = await frame.image.toByteData(format: ui.ImageByteFormat.png);
    if (pngBytes != null) {
      final decoded = image.decodePng(pngBytes.buffer.asUint8List());
      if (decoded != null) {
        // –ö–æ–¥–∏—Ä—É–µ–º –∫–∞–∫ JPEG —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 85%
        final jpegBytes = image.encodeJpg(decoded, quality: 85);
        // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –¥–ª—è GIF (GIF –Ω—É–∂–µ–Ω PNG-–ø–æ–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)
        final jpegDecoded = image.decodeJpg(jpegBytes);
        if (jpegDecoded != null) {
          bytesImages.add(RawFrame(16, ByteData.view(jpegBytes.buffer)));
        }
      }
    }
  }
  return bytesImages;
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä (–≤ 5-10 —Ä–∞–∑ –º–µ–Ω—å—à–µ PNG)
- ‚úÖ –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∏ 85-90%

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è —Ç–æ—á–Ω–æ—Å—Ç–∏ —Ü–≤–µ—Ç–æ–≤ (JPEG - lossy)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ—Ç–Ω–æ –Ω–∞ —Ç–µ–∫—Å—Ç–µ/–∏–∫–æ–Ω–∫–∞—Ö
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –¥–ª—è GIF

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
- JPEG 90%: **80-85%** –º–µ–Ω—å—à–µ
- JPEG 85%: **85-90%** –º–µ–Ω—å—à–µ

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) ‚≠ê‚≠ê‚≠ê

**–ò–¥–µ—è:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ä–µ—Å–∞–π–∑–∞ + JPEG —Å–∂–∞—Ç–∏–µ + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GIF.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```dart
// –í exporter.dart
class CompressedFrame {
  final Duration timeStamp;
  final Uint8List compressedBytes; // JPEG –±–∞–π—Ç—ã
  final int originalWidth;
  final int originalHeight;
  final int compressedWidth;
  final int compressedHeight;
}

void onNewFrame(Frame frame) async {
  final pngBytes = await frame.image.toByteData(format: ui.ImageByteFormat.png);
  if (pngBytes != null) {
    final decoded = image.decodePng(pngBytes.buffer.asUint8List());
    if (decoded != null) {
      // 1. –†–µ—Å–∞–π–∑ –¥–æ 70% (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
      final resized = image.copyResize(
        decoded,
        width: (decoded.width * 0.7).round(),
        height: (decoded.height * 0.7).round(),
        interpolation: image.Interpolation.cubic,
      );
      
      // 2. –°–∂–∞—Ç–∏–µ JPEG —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 88%
      final jpegBytes = image.encodeJpg(resized, quality: 88);
      
      // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∂–∞—Ç—É—é –≤–µ—Ä—Å–∏—é
      _compressedFrames.add(CompressedFrame(
        frame.timeStamp,
        jpegBytes,
        decoded.width,
        decoded.height,
        resized.width,
        resized.height,
      ));
    }
  }
  frame.image.dispose(); // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
}

// –ü—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ GIF:
Future<List<RawFrame>?> exportFrames() async {
  final bytesImages = <RawFrame>[];
  for (final frame in _compressedFrames) {
    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º JPEG
    final decoded = image.decodeJpg(frame.compressedBytes);
    if (decoded != null) {
      // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ PNG –¥–ª—è GIF (GIF –Ω—É–∂–µ–Ω RGBA)
      final pngBytes = image.encodePng(decoded);
      bytesImages.add(RawFrame(16, ByteData.view(pngBytes.buffer)));
    }
  }
  return bytesImages;
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ (–≤ 10-15 —Ä–∞–∑)
- ‚úÖ –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è UI
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
- ‚úÖ –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚ö†Ô∏è –ù–µ–±–æ–ª—å—à–∞—è –ø–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞ (–Ω–æ –¥–ª—è UI –æ–±—ã—á–Ω–æ –Ω–µ–∑–∞–º–µ—Ç–Ω–æ)

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
- –†–µ—Å–∞–π–∑ 70% + JPEG 88%: **~90%** –º–µ–Ω—å—à–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

---

### –í–∞—Ä–∏–∞–Ω—Ç 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ GIF

**–ò–¥–µ—è:** –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—Ö–≤–∞—Ç –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ.

**–ì–¥–µ –∏–∑–º–µ–Ω–∏—Ç—å:** `exporter.dart`, –º–µ—Ç–æ–¥ `_exportGif`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```dart
static Future<List<int>?> _exportGif(DataHolder data) async {
  List<RawFrame> frames = data.frames;
  int width = data.width;
  int height = data.height;

  image.Image mainImage = image.Image.empty();

  for (final frame in frames) {
    final iAsBytes = frame.image.buffer.asUint8List();
    final decodedImage = image.decodePng(iAsBytes);

    if (decodedImage == null) continue;

    // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –†–µ—Å–∞–π–∑ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ GIF
    final optimized = image.copyResize(
      decodedImage,
      width: (width * 0.8).round(),  // –£–º–µ–Ω—å—à–∞–µ–º –¥–æ 80%
      height: (height * 0.8).round(),
      interpolation: image.Interpolation.cubic,
    );

    // –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤
    final quantized = image.quantize(
      optimized,
      numberOfColors: 128, // –í–º–µ—Å—Ç–æ 256 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
      method: image.QuantizeMethod.neuralNet, // –õ—É—á—à–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º
    );

    quantized.frameDuration = frame.durationInMillis;
    mainImage.frames.add(_encodeGifWIthTransparency(quantized));
  }

  return image.encodeGif(mainImage);
}
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
- ‚úÖ –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞—Ö–≤–∞—Ç–∞
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π GIF

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
- ‚ö†Ô∏è –ú–µ–Ω—å—à–µ —ç—Ñ—Ñ–µ–∫—Ç, —á–µ–º —Å–∂–∞—Ç–∏–µ —Å—Ä–∞–∑—É

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞:**
- –†–µ—Å–∞–π–∑ 80% + –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ 128 —Ü–≤–µ—Ç–æ–≤: **~60-70%** –º–µ–Ω—å—à–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ GIF

---

## üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –í–∞—Ä–∏–∞–Ω—Ç | –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ | –ö–∞—á–µ—Å—Ç–≤–æ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ |
|---------|-------------------|----------|-----------|----------------|
| 1. –°–∂–∞—Ç–∏–µ PNG | 50-70% | –û—Ç–ª–∏—á–Ω–æ | –ù–∏–∑–∫–∞—è | ‚úÖ‚úÖ‚úÖ |
| 2. –†–µ—Å–∞–π–∑ | 50-75% | –•–æ—Ä–æ—à–æ | –ù–∏–∑–∫–∞—è | ‚úÖ‚úÖ |
| 3. JPEG | 80-90% | –•–æ—Ä–æ—à–æ | –°—Ä–µ–¥–Ω—è—è | ‚úÖ‚úÖ‚úÖ |
| 4. –ö–æ–º–±–æ (—Ä–µ—Å–∞–π–∑+JPEG) | 90-95% | –•–æ—Ä–æ—à–æ | –í—ã—Å–æ–∫–∞—è | ‚úÖ‚úÖ‚úÖ |
| 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GIF | 60-70% | –•–æ—Ä–æ—à–æ | –ù–∏–∑–∫–∞—è | ‚ùå |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞:
**–í–∞—Ä–∏–∞–Ω—Ç 4 (–ö–æ–º–±–æ):** –†–µ—Å–∞–π–∑ 70% + JPEG 88%
- –†–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–∏—Ç—Å—è –≤ 10-15 —Ä–∞–∑
- –ö–∞—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ö–æ—Ä–æ—à–∏–º –¥–ª—è UI
- –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏

### –î–ª—è –±–∞–ª–∞–Ω—Å–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞:
**–í–∞—Ä–∏–∞–Ω—Ç 1 (–°–∂–∞—Ç–∏–µ PNG):** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π PNG
- –†–∞–∑–º–µ—Ä —É–º–µ–Ω—å—à–∏—Ç—Å—è –≤ 2-3 —Ä–∞–∑–∞
- –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–±–µ–∑ –ø–æ—Ç–µ—Ä—å)
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –î–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
**–í–∞—Ä–∏–∞–Ω—Ç 5 (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è GIF):** –¢–æ–ª—å–∫–æ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ
- –†–∞–∑–º–µ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ GIF —É–º–µ–Ω—å—à–∏—Ç—Å—è –≤ 2-3 —Ä–∞–∑–∞
- –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞—Ö–≤–∞—Ç–∞
- –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
```dart
// –ú–µ–Ω—å—à–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –∫–∞–¥—Ä–æ–≤, –±–æ–ª—å—à–µ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–Ω—ã—Ö
double getQualityForFrame(Frame current, Frame? previous) {
  if (previous == null) return 0.95;
  
  // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–∞–¥—Ä—ã, –µ—Å–ª–∏ –ø–æ—Ö–æ–∂–∏ - –º–µ–Ω—å—à–µ –∫–∞—á–µ—Å—Ç–≤–æ
  final similarity = calculateSimilarity(current, previous);
  if (similarity > 0.95) return 0.75; // –°—Ç–∞—Ç–∏—á–Ω—ã–π –∫–∞–¥—Ä
  return 0.90; // –î–∏–Ω–∞–º–∏—á–Ω—ã–π –∫–∞–¥—Ä
}
```

### 2. –î–µ–ª—å—Ç–∞-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
```dart
// –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏
// –î–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö —á–∞—Å—Ç–µ–π —ç–∫—Ä–∞–Ω–∞ - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –ø–∏–∫—Å–µ–ª–∏
```

### 3. –£–º–Ω–æ–µ –∫–≤–∞–Ω—Ç–æ–≤–∞–Ω–∏–µ
```dart
// –ë–æ–ª—å—à–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π (—Ç–µ–∫—Å—Ç, –∏–∫–æ–Ω–∫–∏)
// –ú–µ–Ω—å—à–µ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Ñ–æ–Ω–∞
```

---

## üîß –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–í–∞—Ä–∏–∞–Ω—Ç 1 - –°–∂–∞—Ç–∏–µ PNG)

–°–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –¥–æ–±–∞–≤–∏—Ç—å —Å–∂–∞—Ç–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞—Ö–≤–∞—Ç–∞:

```dart
// –í exporter.dart
import 'dart:typed_data';
import 'package:image/image.dart' as img;

class Exporter {
  final List<CompressedFrame> _compressedFrames = [];
  
  void onNewFrame(Frame frame) async {
    // –°—Ä–∞–∑—É –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏ —Å–∂–∏–º–∞–µ–º
    final pngBytes = await frame.image.toByteData(
      format: ui.ImageByteFormat.png
    );
    
    if (pngBytes != null) {
      final bytes = pngBytes.buffer.asUint8List();
      final decoded = img.decodePng(bytes);
      
      if (decoded != null) {
        // –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º PNG (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Å–∞–π–∑ –∑–¥–µ—Å—å)
        final optimized = _optimizeImage(decoded);
        final optimizedBytes = img.encodePng(optimized);
        
        _compressedFrames.add(CompressedFrame(
          frame.timeStamp,
          optimizedBytes,
          decoded.width,
          decoded.height,
        ));
      }
    }
    
    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
    frame.image.dispose();
  }
  
  img.Image _optimizeImage(img.Image image) {
    // –û–ø—Ü–∏—è 1: –ü—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å (PNG —É–∂–µ —Å–∂–∞—Ç)
    return image;
    
    // –û–ø—Ü–∏—è 2: –†–µ—Å–∞–π–∑ –¥–æ 80%
    // return img.copyResize(
    //   image,
    //   width: (image.width * 0.8).round(),
    //   height: (image.height * 0.8).round(),
    //   interpolation: img.Interpolation.cubic,
    // );
    
    // –û–ø—Ü–∏—è 3: JPEG —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 88%
    // final jpeg = img.encodeJpg(image, quality: 88);
    // return img.decodeJpg(jpeg)!;
  }
}
```

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

1. **–ö–∞–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∏–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ?**
   - –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä ‚Üí –í–∞—Ä–∏–∞–Ω—Ç 4 (–∫–æ–º–±–æ)
   - –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ ‚Üí –í–∞—Ä–∏–∞–Ω—Ç 1 (PNG –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

2. **–ù—É–∂–Ω–∞ –ª–∏ —ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏?**
   - –î–∞ ‚Üí –í–∞—Ä–∏–∞–Ω—Ç—ã 1, 3, 4 (—Å–∂–∞—Ç–∏–µ —Å—Ä–∞–∑—É)
   - –ù–µ—Ç ‚Üí –í–∞—Ä–∏–∞–Ω—Ç 5 (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ)

3. **–î–æ–ø—É—Å—Ç–∏–º–∞ –ª–∏ –Ω–µ–±–æ–ª—å—à–∞—è –ø–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞?**
   - –î–∞ ‚Üí JPEG (–≤–∞—Ä–∏–∞–Ω—Ç—ã 3, 4)
   - –ù–µ—Ç ‚Üí PNG –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–≤–∞—Ä–∏–∞–Ω—Ç 1)

4. **–ù—É–∂–Ω–æ –ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ?**
   - –î–∞ ‚Üí –¢–æ–ª—å–∫–æ —Å–∂–∞—Ç–∏–µ
   - –ù–µ—Ç ‚Üí –†–µ—Å–∞–π–∑ + —Å–∂–∞—Ç–∏–µ
